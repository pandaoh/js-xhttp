"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("axios"),e=require("axios-retry");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t),r=n(e),i=function(){return i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},i.apply(this,arguments)};function s(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((o=o.apply(t,e||[])).next())}))}function u(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}var c,l=o.default;exports.XHttpMethod=void 0,(c=exports.XHttpMethod||(exports.XHttpMethod={})).GET="GET",c.POST="POST",c.PUT="PUT",c.DELETE="DELETE",c.PATCH="PATCH",c.OPTIONS="OPTIONS";var d=function(){function t(){}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.typeof=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},t}(),f=new(function(){function t(t,e){var n,r,s,u,a,c,l,d;return void 0===e&&(e={}),this.timeout=3e4,this._cancelTokens=[],this._whiteListCancelTokens=[],this._cancelDuplicatedRequest=null===(n=null==t?void 0:t.cancelDuplicatedRequest)||void 0===n||n,this._cancelDuplicatedRequest&&(this._pendingRequests=new Map),this._retryConfig=null!==(r=null==t?void 0:t.retryConfig)&&void 0!==r?r:null,this._requestHandler=null!==(s=null==t?void 0:t.requestHandler)&&void 0!==s?s:void 0,this._responseHandler=null!==(u=null==t?void 0:t.responseHandler)&&void 0!==u?u:void 0,this._errorHandler=null!==(a=null==t?void 0:t.errorHandler)&&void 0!==a?a:void 0,this._requestFinally=null!==(c=null==t?void 0:t.requestFinally)&&void 0!==c?c:void 0,this._setRequestHeaders=null!==(l=null==t?void 0:t.setRequestHeaders)&&void 0!==l?l:void 0,this._defaultAxiosConfig=i({timeout:null!==(d=null==t?void 0:t.timeout)&&void 0!==d?d:this.timeout,validateStatus:function(t){return!0}},e),this.instance=o.default.create(this._defaultAxiosConfig),this._initAxiosRetry(),this._initInterceptors(),this}return t.prototype._initAxiosRetry=function(){var t=this;this._retryConfig&&r.default(this.instance,{retries:this._retryConfig.retry,retryDelay:function(e){return e*t._retryConfig.delay},shouldResetTimeout:!0,retryCondition:function(t){var e;return!!r.default.isNetworkOrIdempotentRequestError(t)||(!t.code||(!!["ECONNRESET","ETIMEDOUT"].includes(t.code)||!("ECONNABORTED"!=t.code||!(null===(e=t.message)||void 0===e?void 0:e.includes("timeout")))))}})},t.prototype._initInterceptors=function(){var t=this;this.instance.interceptors.request.use((function(e){var n;if(t._cancelDuplicatedRequest&&!e.cancelToken&&(t._removePendingRequest(e),t._addPendingRequest(e)),"object"===d.typeof(e)&&null!=t._setRequestHeaders&&(e=t._setRequestHeaders.call(t,e),"object"!==d.typeof(e)))throw new Error("XHttp Error: [setRequestHeaders] must be a function, and return a complete object value(RequestConfig) without missing original attributes!");if(!1!==(null===(n=t._requestHandler)||void 0===n?void 0:n.call(t,e)))return e;null==e||e.cancelRequest()}),(function(e){return o.default.isCancel(e)||(t._cancelDuplicatedRequest&&t._pendingRequests.clear(),t._whiteListCancelTokens=[],t._cancelTokens=[]),Promise.reject(e)})),this.instance.interceptors.response.use((function(e){var n,o,r;if(t._cancelDuplicatedRequest&&!(null===(n=e.config)||void 0===n?void 0:n.cancelToken)&&t._removePendingRequest(e),!1!==(null===(o=t._responseHandler)||void 0===o?void 0:o.call(t,e)))return{status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText,data:null==e?void 0:e.data};null===(r=e.config)||void 0===r||r.cancelRequest()}),(function(e){var n;o.default.isCancel(e)||(t._cancelDuplicatedRequest&&t._pendingRequests.clear(),t._whiteListCancelTokens=[],t._cancelTokens=[]);var r=null!==(n=e.response)&&void 0!==n?n:e;return Promise.reject(r)}))},t.prototype._addPendingRequest=function(t){var e=this,n=[t.method,t.url,JSON.stringify(t.params),JSON.stringify(t.data)].join("&");t.cancelToken=new o.default.CancelToken((function(o){e._pendingRequests.has(n)||(e._pendingRequests.set(n,o),t.cancelRequest=o)}))},t.prototype._removePendingRequest=function(t){var e=[t.method,t.url,JSON.stringify(t.params),JSON.stringify(t.data)].join("&");this._pendingRequests.has(e)&&(this._pendingRequests.get(e)(e),this._pendingRequests.delete(e))},t.prototype.request=function(t,e,n,r){return void 0===n&&(n={}),void 0===r&&(r=!1),s(this,void 0,void 0,(function(){var s,a,c,l=this;return u(this,(function(u){return s=i(i({},n),{url:e,method:t}),this._cancelDuplicatedRequest&&!r||(a=o.default.CancelToken.source(),c=a.token,r?this._whiteListCancelTokens.push(a):this._cancelTokens.push(a),s.cancelToken=c,s.cancelRequest=a.cancel),[2,this.instance.request(s).then((function(t){return t.data})).catch((function(t){var e;return null===(e=l._errorHandler)||void 0===e||e.call(l,t),t})).finally((function(){var t;null===(t=l._requestFinally)||void 0===t||t.call(l)}))]}))}))},t.prototype.get=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this.request(exports.XHttpMethod.GET,t,i(i({},n),{params:e}),o)]}))}))},t.prototype.post=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this.request(exports.XHttpMethod.POST,t,i(i({},n),{data:e}),o)]}))}))},t.prototype.put=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this.request(exports.XHttpMethod.PUT,t,i(i({},n),{data:e}),o)]}))}))},t.prototype.patch=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this.request(exports.XHttpMethod.PATCH,t,i(i({},n),{data:e}),o)]}))}))},t.prototype.delete=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this.request(exports.XHttpMethod.DELETE,t,i(i({},n),{data:e}),o)]}))}))},t.prototype.postForm=function(t,e,n,o){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===o&&(o=!1),s(this,void 0,void 0,(function(){var r;return u(this,(function(s){return r=new FormData,Object.keys(e).forEach((function(t){r.append(t,"object"==d.typeof(e[t])?JSON.stringify(e[t]):e[t])})),[2,this.request(exports.XHttpMethod.POST,t,i(i({},n),{data:r,headers:{"Content-Type":"multipart/form-data;charset=UTF-8;"}}),o)]}))}))},t.prototype.postFile=function(t,e,n,o,r,a,c){return void 0===n&&(n="file"),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===a&&(a={}),void 0===c&&(c=!1),s(this,void 0,void 0,(function(){var s;return u(this,(function(u){return s=new FormData,Array.isArray(e)?e.forEach((function(t,e){r?s.append(o?"".concat(n,"[]"):"".concat(n,"[").concat(e,"]"),t):s.append(n,t)})):s.append(n,e),[2,this.request(exports.XHttpMethod.POST,t,i(i({},a),{data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}),c)]}))}))},t.prototype.cancelRequest=function(t){var e,n;if(this._cancelDuplicatedRequest){try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this._pendingRequests),r=o.next();!r.done;r=o.next()){var i=a(r.value,2),s=i[0];(0,i[1])(t?"".concat(t,": ").concat(s):s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}this._pendingRequests.clear()}else this._cancelTokens.forEach((function(e){null==e||e.cancel(t)}));return this},t.prototype.cancelWhiteListRequest=function(t){return this._whiteListCancelTokens.forEach((function(e){null==e||e.cancel(t)})),this},t.prototype.getCancelToken=function(){return o.default.CancelToken.source()},t.prototype.getBaseURL=function(){return this.instance.defaults.baseURL},t.prototype.setBaseURL=function(t){return this.instance.defaults.baseURL=t,this},t.prototype.getHeaders=function(){return this.instance.defaults.headers},t.prototype.setHeaders=function(t){return this.instance.defaults.headers=t,this},t.prototype.getHeader=function(t){return this.instance.defaults.headers.common[t]},t.prototype.setHeader=function(t,e){return e?this.instance.defaults.headers.common[t]=e:delete this.instance.defaults.headers.common[t],this},t.prototype.setRequestTimeout=function(t){return this.instance.defaults.timeout=t,this},t.prototype.getAuthToken=function(){var t=this.getHeader("Authorization");return null==t?null:t},t.prototype.setAuthToken=function(t){return this.setHeader("Authorization",t),this},t.prototype.isCancel=function(t){return o.default.isCancel(t)},t.prototype.getInstance=function(){return this.instance},t.prototype.create=function(e,n){return void 0===n&&(n={}),new t(e,n)},t}());exports.Axios=l,exports.XHttp=f,exports.XHttpUtils=d,exports.default=f;
