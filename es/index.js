import t from"axios";import e from"axios-retry";var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=e.call(t,s)}catch(t){u=[6,t],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}"function"==typeof SuppressedError&&SuppressedError;var s,u=t;!function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.PATCH="PATCH",t.OPTIONS="OPTIONS",t.get="GET",t.post="POST",t.put="PUT",t.delete="DELETE",t.patch="PATCH",t.options="OPTIONS"}(s||(s={}));var a=function(){function t(){}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.typeof=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},t}(),c=function(){function u(e,r){var i,o,s,u,a,c,l,d,f,p;return void 0===r&&(r={}),this.timeout=3e4,this._cancelTokens=[],this._whiteListCancelTokens=[],this._cancelDuplicatedRequest=null===(i=null==e?void 0:e.cancelDuplicatedRequest)||void 0===i||i,this._cancelDuplicatedRequest&&(this._pendingRequests=new Map),this._rejectErrorPromise=null===(o=null==e?void 0:e.rejectErrorPromise)||void 0===o||o,this._retryConfig=null!==(s=null==e?void 0:e.retryConfig)&&void 0!==s?s:null,this._requestHandler=null!==(u=null==e?void 0:e.requestHandler)&&void 0!==u?u:void 0,this._responseHandler=null!==(a=null==e?void 0:e.responseHandler)&&void 0!==a?a:void 0,this._errorHandler=null!==(c=null==e?void 0:e.errorHandler)&&void 0!==c?c:void 0,this._requestFinally=null!==(l=null==e?void 0:e.requestFinally)&&void 0!==l?l:void 0,this._setRequestHeaders=null!==(d=null==e?void 0:e.setRequestHeaders)&&void 0!==d?d:void 0,this._formatResultAdaptor=null!==(f=null==e?void 0:e.formatResultAdaptor)&&void 0!==f?f:void 0,this._defaultAxiosConfig=n({timeout:null!==(p=null==e?void 0:e.timeout)&&void 0!==p?p:this.timeout,validateStatus:function(t){return!0}},r),this.instance=t.create(this._defaultAxiosConfig),this._initAxiosRetry(),this._initInterceptors(),this}return u.prototype._initAxiosRetry=function(){var n=this;this._retryConfig&&e(this.instance,{retries:this._retryConfig.retry,retryDelay:function(t){return t*n._retryConfig.delay},shouldResetTimeout:!0,retryCondition:function(n){var r,i,o;return!((null===(r=n.message)||void 0===r?void 0:r.includes("not-retry"))||t.isCancel(n)||(null===(i=n.message)||void 0===i?void 0:i.includes("custom-error")))&&(!!e.isNetworkOrIdempotentRequestError(n)||(!n.code||(!!["ECONNRESET","ETIMEDOUT"].includes(n.code)||!("ECONNABORTED"!=n.code||!(null===(o=n.message)||void 0===o?void 0:o.includes("timeout"))))))}})},u.prototype._initInterceptors=function(){var e=this;this.instance.interceptors.request.use((function(t){var n;if(e._cancelTokens.length>100&&(e._cancelTokens=[]),e._whiteListCancelTokens.length>100&&(e._whiteListCancelTokens=[]),e._cancelDuplicatedRequest&&!t.cancelToken&&(e._removePendingRequest(t),e._addPendingRequest(t)),"object"===a.typeof(t)&&null!=e._setRequestHeaders&&(t=e._setRequestHeaders.call(e,t),"object"!==a.typeof(t)))throw new Error("XHttp Error: [setRequestHeaders] must be a function, and return a complete object value(RequestConfig) without missing original attributes!");return null===(n=e._requestHandler)||void 0===n||n.call(e,t),t}),(function(n){return t.isCancel(n)||(e._cancelDuplicatedRequest&&e._pendingRequests.clear(),e._whiteListCancelTokens=[],e._cancelTokens=[]),Promise.reject(n)})),this.instance.interceptors.response.use((function(t){var n,r;return e._cancelDuplicatedRequest&&!(null===(n=t.config)||void 0===n?void 0:n.cancelToken)&&e._removePendingRequest(t.config),null===(r=e._responseHandler)||void 0===r||r.call(e,t),{status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,data:null==t?void 0:t.data}}),(function(n){var r;t.isCancel(n)||(e._cancelDuplicatedRequest&&e._pendingRequests.clear(),e._whiteListCancelTokens=[],e._cancelTokens=[]);var i=null!==(r=n.response)&&void 0!==r?r:n;return Promise.reject(i)}))},u.prototype._addPendingRequest=function(e){var n=this,r=[e.method,e.url,JSON.stringify(e.params),JSON.stringify(e.data)].join("&");e.cancelToken=new t.CancelToken((function(t){n._pendingRequests.has(r)||(n._pendingRequests.set(r,t),e.cancelRequest=t)}))},u.prototype._removePendingRequest=function(t){var e=[t.method,t.url,JSON.stringify("string"==a.typeof(t.params)?JSON.parse(t.params):t.params),JSON.stringify("string"==a.typeof(t.data)?JSON.parse(t.data):t.data)].join("&");this._pendingRequests.has(e)&&(this._pendingRequests.get(e)(e),this._pendingRequests.delete(e))},u.prototype.request=function(e,o,s,u){var a,c,l;return void 0===s&&(s={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){var r,d,f,p=this;return i(this,(function(i){return(r=n({url:o,method:e},s)).rejectErrorPromise=null!==(a=r.rejectErrorPromise)&&void 0!==a?a:this._rejectErrorPromise,r.formatResultAdaptor=null!==(c=r.formatResultAdaptor)&&void 0!==c?c:this._formatResultAdaptor,r.isWhiteList=null!==(l=null!=u?u:s.isWhiteList)&&void 0!==l&&l,this._cancelDuplicatedRequest&&!u||(d=t.CancelToken.source(),f=d.token,u?this._whiteListCancelTokens.push(d):this._cancelTokens.push(d),r.cancelToken=f,r.cancelRequest=d.cancel),[2,this.instance.request(r).then((function(t){var e;return r.formatResultAdaptor?null===(e=r.formatResultAdaptor)||void 0===e?void 0:e.call(p,t.data):t.data})).catch((function(t){var e;return null===(e=p._errorHandler)||void 0===e?void 0:e.call(p,t,r)})).finally((function(){var t;null===(t=p._requestFinally)||void 0===t||t.call(p,r)}))]}))}))},u.prototype.axiosRequest=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){return o=!1,"string"==typeof t?(n=t,r=e||{}):(n=t.url||"",r=t,o=t.isWhiteList||!1),[2,this.request((null==r?void 0:r.method)||"GET",n,r,o)]}))}))},u.prototype.allInRequest=function(t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.request((null==t?void 0:t.method)||"GET",(null==t?void 0:t.url)||"",t||{},(null==t?void 0:t.isWhiteList)||!1)]}))}))},u.prototype.get=function(t,e,o,u){return void 0===e&&(e={}),void 0===o&&(o={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.request(s.GET,t,n(n({},o),{params:e}),u)]}))}))},u.prototype.post=function(t,e,o,u){return void 0===e&&(e={}),void 0===o&&(o={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.request(s.POST,t,n(n({},o),{data:e}),u)]}))}))},u.prototype.put=function(t,e,o,u){return void 0===e&&(e={}),void 0===o&&(o={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.request(s.PUT,t,n(n({},o),{data:e}),u)]}))}))},u.prototype.patch=function(t,e,o,u){return void 0===e&&(e={}),void 0===o&&(o={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.request(s.PATCH,t,n(n({},o),{data:e}),u)]}))}))},u.prototype.delete=function(t,e,o,u){return void 0===e&&(e={}),void 0===o&&(o={}),void 0===u&&(u=!1),r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.request(s.DELETE,t,n(n({},o),{data:e}),u)]}))}))},u.prototype.postForm=function(t,e,o,u,c,l){return void 0===e&&(e={}),void 0===o&&(o=!1),void 0===u&&(u=!1),void 0===c&&(c={}),void 0===l&&(l=!1),r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return r=new FormData,Object.keys(e).forEach((function(t){if(Array.isArray(e[t]))for(var n in e[t])o?r.append(u?"".concat(t,"[]"):"".concat(t,"[").concat(n,"]"),e[t][n]):r.append(t,e[t][n]);else r.append(t,"object"==a.typeof(e[t])?JSON.stringify(e[t]):e[t])})),[2,this.request(s.POST,t,n({data:r,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8;"}},c),l)]}))}))},u.prototype.postFile=function(t,e,o,u,a,c,l){return void 0===o&&(o="file"),void 0===u&&(u=!1),void 0===a&&(a=!1),void 0===c&&(c={}),void 0===l&&(l=!1),r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return r=new FormData,Array.isArray(e)?e.forEach((function(t,e){u?r.append(a?"".concat(o,"[]"):"".concat(o,"[").concat(e,"]"),t):r.append(o,t)})):r.append(o,e),[2,this.request(s.POST,t,n({data:r,headers:{"Content-Type":"multipart/form-data"}},c),l)]}))}))},u.prototype.cancelRequest=function(t){var e,n;if(this._cancelDuplicatedRequest){try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this._pendingRequests),i=r.next();!i.done;i=r.next()){var s=o(i.value,2),u=s[0];(0,s[1])(t?"".concat(t,": ").concat(u):u)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this._pendingRequests.clear()}else this._cancelTokens.forEach((function(e){null==e||e.cancel(t)})),this._cancelTokens=[];return this},u.prototype.cancelWhiteListRequest=function(t){return this._whiteListCancelTokens.forEach((function(e){null==e||e.cancel(t)})),this._whiteListCancelTokens=[],this},u.prototype.getCancelToken=function(){return t.CancelToken.source()},u.prototype.getBaseURL=function(){return this.instance.defaults.baseURL},u.prototype.setBaseURL=function(t){return this.instance.defaults.baseURL=t,this},u.prototype.getHeaders=function(){return this.instance.defaults.headers},u.prototype.setHeaders=function(t){return this.instance.defaults.headers=t,this},u.prototype.getHeader=function(t){return this.instance.defaults.headers.common[t]},u.prototype.setHeader=function(t,e){return e?this.instance.defaults.headers.common[t]=e:delete this.instance.defaults.headers.common[t],this},u.prototype.setRequestTimeout=function(t){return this.instance.defaults.timeout=t,this},u.prototype.getAuthToken=function(){var t=this.getHeader("Authorization");return null==t?null:t},u.prototype.setAuthToken=function(t){return this.setHeader("Authorization",t),this},u.prototype.isCancel=function(e){return t.isCancel(e)},u.prototype.getInstance=function(){return this.instance},u.prototype.create=function(t,e){return void 0===e&&(e={}),new u(t,e)},u}(),l={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",301:"资源永久移动，请求的资源已被永久的移动到新 URI，返回信息会包括新的 URI，浏览器会自动定向到新 URI。",302:"资源临时移动，只是临时被移动，客户端可继续使用原有 URI。",303:"查看其它地址，与 301 类似，使用 GET 和 POST 请求查看。",304:"资源未修改，所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},d=new c;export{u as Axios,l as CODE_MSG,d as XHttp,c as XHttpClass,s as XHttpMethod,a as XHttpUtils,d as default};
